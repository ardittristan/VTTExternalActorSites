!function(e){var t={};function a(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(i,n,function(t){return e[t]}.bind(null,n));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=391)}({0:function(e,t,a){const i=a(104);e.exports=function(e){return i.get(i18n,e)||e}},104:function(e,t,a){const i=a(105),n=new Set(["__proto__","prototype","constructor"]);function l(e){const t=e.split("."),a=[];for(let e=0;e<t.length;e++){let i=t[e];for(;"\\"===i[i.length-1]&&void 0!==t[e+1];)i=i.slice(0,-1)+".",i+=t[++e];a.push(i)}return a.some((e=>n.has(e)))?[]:a}e.exports={get(e,t,a){if(!i(e)||"string"!=typeof t)return void 0===a?e:a;const n=l(t);if(0!==n.length){for(let t=0;t<n.length;t++)if(null==(e=e[n[t]])){if(t!==n.length-1)return a;break}return void 0===e?a:e}},set(e,t,a){if(!i(e)||"string"!=typeof t)return e;const n=e,r=l(t);for(let t=0;t<r.length;t++){const n=r[t];i(e[n])||(e[n]={}),t===r.length-1&&(e[n]=a),e=e[n]}return n},delete(e,t){if(!i(e)||"string"!=typeof t)return!1;const a=l(t);for(let t=0;t<a.length;t++){const n=a[t];if(t===a.length-1)return delete e[n],!0;if(e=e[n],!i(e))return!1}},has(e,t){if(!i(e)||"string"!=typeof t)return!1;const a=l(t);if(0===a.length)return!1;for(let t=0;t<a.length;t++){if(!i(e))return!1;if(!(a[t]in e))return!1;e=e[a[t]]}return!0}}},105:function(e,t,a){e.exports=e=>{const t=typeof e;return null!==e&&("object"===t||"function"===t)}},391:function(e,t,a){a.r(t);var i=a(0),n=a.n(i);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const r=Object.freeze({ABILITY:"ability",PROFICIENCY:"proficiency",CIRCUMSTANCE:"circumstance",ITEM:"item",STATUS:"status",UNTYPED:"untyped"});class s{constructor(e,t,a,i=!0,n,r){l(this,"name",void 0),l(this,"modifier",void 0),l(this,"type",void 0),l(this,"enabled",void 0),l(this,"source",void 0),l(this,"notes",void 0),l(this,"ignored",void 0),l(this,"custom",void 0),l(this,"damageType",void 0),l(this,"predicate",void 0),l(this,"critical",void 0),l(this,"traits",void 0),this.name=e,this.modifier=t,this.type=a,this.enabled=i,this.ignored=!1,this.custom=!1,n&&(this.source=n),r&&(this.notes=r)}}let o={},d={},u={},c={},p={};const v=Object.freeze({fromLevelAndRank:(e,t)=>{switch(t||0){case 0:return o.atLevel(e);case 1:return d.atLevel(e);case 2:return u.atLevel(e);case 3:return c.atLevel(e);case 4:return p.atLevel(e);default:throw new RangeError(`invalid proficiency rank: ${t}`)}}});class f{static getFlattenedConditions(e){const t=new Map;return e.sort(((e,t)=>f.__sortCondition(e,t))).forEach((a=>{let i,n=`${a.data.base}`;if(a.data.value.isValued&&(n=`${n} ${a.data.value.value}`),t.has(n)?i=t.get(n):(i={id:a._id,active:a.data.active,name:n,value:a.data.value.isValued?a.data.value.value:void 0,description:a.data.description.value,img:a.img,references:!1,parents:[],children:[],overrides:[],overriddenBy:[],immunityFrom:[]},t.set(n,i)),a.data.references.parent){const t=e.find((e=>e._id===a.data.references.parent.id));if(t){const e={id:a.data.references.parent,name:t.name,base:t.data.base,text:""};t.data.value.isValued&&(e.name=`${e.name} ${t.data.value.value}`),e.text=`@Compendium[pf2e.conditionitems.${t.data.base}]{${e.name}}`,i.references=!0,i.parents.push(e)}}a.data.references.children.forEach((t=>{const n=e.find((e=>e._id===t.id));if(n){const e={id:a.data.references.parent,name:n.name,base:n.data.base,text:""};n.data.value.isValued&&(e.name=`${e.name} ${n.data.value.value}`),e.text=`@Compendium[pf2e.conditionitems.${n.data.base}]{${e.name}}`,i.references=!0,i.children.push(e)}})),a.data.references.overrides.forEach((t=>{const n=e.find((e=>e._id===t.id));if(n){const e={id:a.data.references.parent,name:n.name,base:n.data.base,text:""};n.data.value.isValued&&(e.name=`${e.name} ${n.data.value.value}`),e.text=`@Compendium[pf2e.conditionitems.${n.data.base}]{${e.name}}`,i.references=!0,i.overrides.push(e)}})),a.data.references.overriddenBy.forEach((t=>{const n=e.find((e=>e._id===t.id));if(n){const e={id:a.data.references.parent,name:n.name,base:n.data.base,text:""};n.data.value.isValued&&(e.name=`${e.name} ${n.data.value.value}`),e.text=`@Compendium[pf2e.conditionitems.${n.data.base}]{${e.name}}`,i.references=!0,i.overriddenBy.push(e)}})),a.data.references.immunityFrom.forEach((t=>{const n=e.find((e=>e._id===t.id));if(n){const e={id:a.data.references.parent,name:n.name,base:n.data.base,text:""};n.data.value.isValued&&(e.name=`${e.name} ${n.data.value.value}`),e.text=`@Compendium[pf2e.conditionitems.${n.data.base}]{${e.name}}`,i.references=!0,i.immunityFrom.push(e)}}))})),Array.from(t.values())}static __sortCondition(e,t){return e.data.active===t.data.active?e.data.base===t.data.base?e.data.value.isValued?t.data.value.value-e.data.value.value:0:e.data.base.localeCompare(t.data.base):e.data.active&&!t.data.active?-1:!e.data.active&&t.data.active?1:0}}function m(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class h{constructor({normal:e=0,light:t=0}={}){m(this,"normal",void 0),m(this,"light",void 0),this.normal=e+Math.floor(t/10),this.light=t%10}get isNegligible(){return 0===this.normal&&0===this.light}get isLight(){return this.toLightBulk()<10&&!this.isNegligible}toLightBulk(){return 10*this.normal+this.light}plus(e){return new h({normal:this.normal+e.normal,light:this.light+e.light})}minus(e){const[t,a]=this._toSingleNumber(e),i=t-a;return i<0?new h:new h({normal:Math.floor(i/10),light:i%10})}_toSingleNumber(e){return[10*this.normal+this.light,10*e.normal+e.light]}times(e){return new h({normal:this.normal*e,light:this.light*e})}isSmallerThan(e){const[t,a]=this._toSingleNumber(e);return t<a}isBiggerThan(e){const[t,a]=this._toSingleNumber(e);return t>a}isEqualTo(e){return this.normal===e.normal&&this.light===e.light}isPositive(){return this.normal>0||this.light>0}toString(){return`normal: ${this.normal}; light: ${this.light}`}}const g={ignoreCoinBulk:!1,ignoreContainerOverflow:!1};function b(e,t,a=!1,i=g){return C(new F({holdsItems:e}),t,a,i)}const y=/^(\d*)l$/i,k=/^(\d+);\s*(\d*)l$/i;function P(e){if(null==e)return;const t=e.trim();if(/^\d+$/.test(t))return new h({normal:parseInt(t,10)});const a=t.match(y);if(a)return new h({light:parseInt(a[1]||"1",10)});const i=t.match(k);if(i){const[,e,t]=i;return new h({normal:parseInt(e,10),light:parseInt(t||"1",10)})}}function E(e){return 0===e.normal&&0===e.light?"-":e.normal>0&&0===e.light?`${e.normal}`:1===e.light&&0===e.normal?"L":e.light>0&&0===e.normal?`${e.light}L`:`${e.normal}; ${e.light}L`}class F{constructor({id:e="",bulk:t=new h,quantity:a=1,stackGroup:i,isEquipped:n=!1,unequippedBulk:l,equippedBulk:r,holdsItems:s=[],negateBulk:o=new h,extraDimensionalContainer:d=!1}={}){m(this,"id",void 0),m(this,"bulk",void 0),m(this,"quantity",void 0),m(this,"stackGroup",void 0),m(this,"isEquipped",void 0),m(this,"unequippedBulk",void 0),m(this,"equippedBulk",void 0),m(this,"holdsItems",void 0),m(this,"negateBulk",void 0),m(this,"extraDimensionalContainer",void 0),this.id=e,this.bulk=t,this.quantity=a,this.stackGroup=i,this.holdsItems=s,this.negateBulk=o,this.unequippedBulk=l,this.equippedBulk=r,this.isEquipped=n,this.extraDimensionalContainer=d}get reducesBulk(){return!this.negateBulk.isNegligible}}function C(e,t,a=!1,i=g){const[n,l]=function(e,t,a){const i=e.stackGroup;if(n=i,null==n||""===n.trim())return[L(e).times(e.quantity),{}];var n;return S({[i]:e.quantity},t,a)}(e,t,i),[r,s]=e.holdsItems.map((a=>C(a,t,e.extraDimensionalContainer,i))).reduce(x,[new h,{}]),o=w(l,function(e,t,a){if(t.extraDimensionalContainer||a)return{};return e}(s,e,i.ignoreContainerOverflow),O),[d,u]=S(o,t,i);return[n.plus(B(r,e,a)).plus(d),u]}function w(e,t,a){const i=new Set([...Object.keys(e),...Object.keys(t)]),n={};for(const l of i)l in e&&l in t?n[l]=a(e[l],t[l]):l in e?n[l]=e[l]:l in t&&(n[l]=t[l]);return n}function L(e){return void 0===e.unequippedBulk||null===e.unequippedBulk||e.isEquipped?void 0!==e.equippedBulk&&null!==e.equippedBulk&&e.isEquipped?e.equippedBulk:e.bulk:e.unequippedBulk}function S(e,t,a=g){return Object.entries(e).filter((([e])=>!(a.ignoreCoinBulk&&"coins"===e))).map((([e,a])=>{if(!(e in t))throw new Error(`No stack definition found for stack ${e}`);const{size:i,lightBulk:n}=t[e],l=Math.floor(a/i);return[new h({light:l*n}),{[e]:a%i}]})).reduce(x,[new h,{}])}function B(e,t,a){return function(e,t){return e.extraDimensionalContainer&&!t||e.reducesBulk&&e.isEquipped}(t,a)?e.minus(t.negateBulk):e}function O(e,t){return e+t}function x(e,t){const[a,i]=e,[n,l]=t;return[a.plus(n),w(i,l,O)]}function I(e=[]){const t=new Map;return e.forEach((e=>T(e,t))),t}function T(e,t){t.set(e.id,e),e.holdsItems.forEach((e=>T(e,t)))}function A(e){return function(e){const t=new Set(e.map((e=>e._id))),a=z(e,(e=>{var a,i,n;const l=null!==(a=null===(i=e.data)||void 0===i||null===(n=i.containerId)||void 0===n?void 0:n.value)&&void 0!==a?a:null;return null!==l&&t.has(l)?l:null}));if(a.has(null)){return N(a.get(null),a)}return[]}(e.items.filter(q))}function N(e,t){return e.map((e=>{const a=e._id;if(null!=a&&t.has(a)){return _(e,N(t.get(a),t))}return _(e)}))}function _(e,t=[]){var a,i,n,l,r,s,o,d,u,c,p,v,f,m,g,b,y,k,E,C,w,L;const $=e._id,S=null===(a=e.data)||void 0===a||null===(i=a.weight)||void 0===i?void 0:i.value,B=null!==(n=null===(l=e.data)||void 0===l||null===(r=l.quantity)||void 0===r?void 0:r.value)&&void 0!==n?n:0,O=null!==(s=null===(o=e.data)||void 0===o||null===(d=o.equipped)||void 0===d?void 0:d.value)&&void 0!==s&&s,x=null===(u=e.data)||void 0===u||null===(c=u.equippedBulk)||void 0===c?void 0:c.value,I=null===(p=e.data)||void 0===p||null===(v=p.unequippedBulk)||void 0===v?void 0:v.value,T=null===(f=e.data)||void 0===f||null===(m=f.stackGroup)||void 0===m?void 0:m.value,A=null===(g=e.data)||void 0===g||null===(b=g.negateBulk)||void 0===b?void 0:b.value,N=null!==(y=null===(k=e.data)||void 0===k||null===(E=k.traits)||void 0===E||null===(C=E.value)||void 0===C?void 0:C.includes("extradimensional"))&&void 0!==y&&y;return new F({id:$,bulk:null!==(w=P(D(S)))&&void 0!==w?w:new h,negateBulk:null!==(L=P(D(A)))&&void 0!==L?L:new h,unequippedBulk:P(D(I)),equippedBulk:P(D(x)),holdsItems:t,stackGroup:T,isEquipped:O,quantity:B,extraDimensionalContainer:N})}function D(e){if(null==e)return;return`${e}`.toLowerCase().trim()}function q(e){return"data"in e&&"quantity"in e.data}const M={bolts:{size:10,lightBulk:1},arrows:{size:10,lightBulk:1},slingBullets:{size:10,lightBulk:1},blowgunDarts:{size:10,lightBulk:1},rations:{size:7,lightBulk:1},coins:{size:1e3,lightBulk:10},gems:{size:2e3,lightBulk:10}},H={Tiny:{bulkLimitFactor:.5,treatsAsLight:"-",treatsAsNegligible:null},Small:{bulkLimitFactor:1,treatsAsLight:"L",treatsAsNegligible:"-"},Medium:{bulkLimitFactor:1,treatsAsLight:"L",treatsAsNegligible:"-"},Large:{bulkLimitFactor:2,treatsAsLight:"1",treatsAsNegligible:"L"},Huge:{bulkLimitFactor:4,treatsAsLight:"2",treatsAsNegligible:"1"},Gargantuan:{bulkLimitFactor:8,treatsAsLight:"4",treatsAsNegligible:"2"}};function j(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class J{constructor({item:e,heldItems:t,negateBulk:a,capacity:i,heldItemBulk:n,isInContainer:l,formattedNegateBulk:r,formattedHeldItemBulk:s,formattedCapacity:o}){j(this,"item",void 0),j(this,"heldItems",void 0),j(this,"negateBulk",void 0),j(this,"heldItemBulk",void 0),j(this,"isInContainer",void 0),j(this,"formattedHeldItemBulk",void 0),j(this,"formattedNegateBulk",void 0),j(this,"formattedCapacity",void 0),j(this,"capacity",void 0),this.item=e,this.heldItems=t,this.negateBulk=a,this.heldItemBulk=n,this.isInContainer=l,this.formattedHeldItemBulk=s,this.formattedNegateBulk=r,this.formattedCapacity=o,this.capacity=i}get isContainer(){return!this.capacity.isNegligible}get isCollapsed(){var e,t,a,i;return null!==(e=null===(t=this.item)||void 0===t||null===(a=t.data)||void 0===a||null===(i=a.collapsed)||void 0===i?void 0:i.value)&&void 0!==e&&e}get isNotInContainer(){return!this.isInContainer}_getLightBulkCapacityThreshold(){return this.capacity.normal>0?this.capacity.toLightBulk()+10:this.capacity.light}get fullPercentage(){const e=this._getLightBulkCapacityThreshold();if(0===e)return 0;const t=this.heldItemBulk.toLightBulk();return Math.floor(t/e*100)}get fullPercentageMax100(){const e=this.fullPercentage;return e>100?100:e}get isOverLoaded(){return this.capacity.normal>0?this.heldItemBulk.toLightBulk()>=this.capacity.toLightBulk()+10:this.heldItemBulk.toLightBulk()>this.capacity.light}}function z(e,t){const a=new Map;for(const i of e){const e=t(i);void 0===a.get(e)?a.set(e,[i]):a.get(e).push(i)}return a}function R(e,t=[],a=[],i,n,l){var r,s,o,d,u,c;const p=null!==(r=P(null===(s=e.data)||void 0===s||null===(o=s.negateBulk)||void 0===o?void 0:o.value))&&void 0!==r?r:new h,[v]=b(a,n,!1,l),f=null!==(d=P(null===(u=e.data)||void 0===u||null===(c=u.bulkCapacity)||void 0===c?void 0:c.value))&&void 0!==d?d:new h;return new J({item:e,heldItems:t,negateBulk:p,capacity:f,heldItemBulk:v,isInContainer:i,formattedNegateBulk:E(p),formattedHeldItemBulk:E(v),formattedCapacity:E(f)})}function U(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class W{constructor(e,t,a){U(this,"combinedBulk",void 0),U(this,"encumberedAt",void 0),U(this,"limit",void 0),this.combinedBulk=e,this.encumberedAt=t,this.limit=a}get encumberedPercentage(){const e=this.combinedBulk.toLightBulk(),t=10*this.encumberedAt+10;return Math.floor(e/t*100)}get limitPercentage(){const e=this.combinedBulk.toLightBulk(),t=10*this.limit+10;return Math.floor(e/t*100)}get limitPercentageMax100(){return this.limitPercentage>100?100:this.limitPercentage}get isEncumbered(){return this.combinedBulk.normal>this.encumberedAt}get isOverLimit(){return this.combinedBulk.normal>this.limit}get bulk(){return this.combinedBulk.normal}}const G={armorChatData(e){const t=JSON.parse(JSON.stringify(e.data)),a=[PF2E.armorTypes[t.armorType.value],PF2E.armorGroups[t.group.value],`${Y(V(t))} ${n()("PF2E.ArmorArmorLabel")}`,`${t.dex.value||0} ${n()("PF2E.ArmorDexLabel")}`,`${t.check.value||0} ${n()("PF2E.ArmorCheckLabel")}`,`${t.speed.value||0} ${n()("PF2E.ArmorSpeedLabel")}`,t.traits.value,t.equipped.value?n()("PF2E.ArmorEquippedLabel"):null];return t.properties=a.filter((e=>null!==e)),t.traits=null,t},equipmentChatData(e){const t=JSON.parse(JSON.stringify(e.data)),a=[t.equipped.value?n()("PF2E.EquipmentEquippedLabel"):null];return t.properties=a.filter((e=>null!==e)),t},weaponChatData(e,t){var a,i,n;const l=JSON.parse(JSON.stringify(e.data));t=t.data;const r=[],s=l.traits.value;let o=!1;if("weapon"!==e.type)throw new Error("tried to create a weapon chat data for a non-weapon item");if(0!==(l.traits.value||[]).length)for(let e=0;e<l.traits.value.length;e++){const t={label:PF2E.weaponTraits[l.traits.value[e]]||l.traits.value[e].charAt(0).toUpperCase()+l.traits.value[e].slice(1),description:PF2E.traitsDescriptions[l.traits.value[e]]||""};r.push(t),s[e].match("(\\btwo-hand\\b)-(d\\d+)")&&(o=!0)}const d=(l.traits.value||[]).includes("finesse"),u=d&&t.abilities.dex.mod>t.abilities.str.mod?"dex":l.ability.value||"str",c=l.weaponType.value||"simple",p={type:"default",value:0};var f,m,h,g,b,y,k,P;if(Object.keys(PF2E.weaponTypes).includes(c))p.type="martial",p.value=(null===(f=t.martial)||void 0===f||null===(m=f[c])||void 0===m?void 0:m.value)||0;else try{const e=t.items.find((e=>e._id===c));if("martial"===e.type){var E;p.type="skill";const a=(null===(E=e.data.proficient)||void 0===E?void 0:E.value)||0;p.value=v.fromLevelAndRank(t.details.level.value,a).modifier}}catch(e){console.log(`PF2E | Could not find martial skill for ${c}`)}l.proficiency=p,l.attackRoll=("bomb"===(null===(g=(h=l).group)||void 0===g?void 0:g.value)?null!==(k=K(null==h||null===(P=h.bonus)||void 0===P?void 0:P.value))&&void 0!==k?k:0:null!==(b=K(null==h||null===(y=h.potencyRune)||void 0===y?void 0:y.value))&&void 0!==b?b:0)+(null!==(a=null===(i=t.abilities)||void 0===i||null===(n=i[u])||void 0===n?void 0:n.mod)&&void 0!==a?a:0)+p.value;l.group.value&&(l.critSpecialization={label:PF2E.weaponGroups[l.group.value],description:PF2E.weaponDescriptions[l.group.value]}),l.isTwohanded=!!o,l.wieldedTwoHands=!!l.hands.value,l.isFinesse=d,l.properties=[].filter((e=>!!e)),l.traits=r.filter((e=>!!e));const F=function(e){if("weapon"===e.type){const t=(e.data.traits.value||[]).includes("agile");switch((e.data.MAP||{}).value){case"1":return{map2:-1,map3:-2};case"2":return{map2:-2,map3:-4};case"3":return{map2:-3,map3:-6};case"4":return{map2:-4,map3:-8};case"5":return{map2:-5,map3:-10};default:return t?{map2:-4,map3:-8}:{map2:-5,map3:-10}}}return{map2:-5,map3:-10}}(e);return l.map2=F.map2,l.map3=F.map3,l},meleeChatData(e){const t=JSON.parse(JSON.stringify(e.data)),a=[];if(0!==(t.traits.value||[]).length)for(let e=0;e<t.traits.value.length;e++){const i={label:PF2E.weaponTraits[t.traits.value[e]]||t.traits.value[e].charAt(0).toUpperCase()+t.traits.value[e].slice(1),description:PF2E.traitsDescriptions[t.traits.value[e]]||""};a.push(i)}const i=(t.traits.value||[]).includes("agile");return t.map2=i?"-4":"-5",t.map3=i?"-8":"-10",t.traits=a.filter((e=>!!e)),t},consumableChatData(e){const t=JSON.parse(JSON.stringify(e.data));return t.consumableType.str=PF2E.consumableTypes[t.consumableType.value],t.properties=[t.consumableType.str,`${t.charges.value}/${t.charges.max} ${n()("PF2E.ConsumableChargesLabel")}`],t.hasCharges=t.charges.value>=0,t},treasureChatData:e=>JSON.parse(JSON.stringify(e.data)),toolChatData(e,t){const a=JSON.parse(JSON.stringify(e.data)),i=t.data.abilities[a.ability.value].label,n=a.proficient.value||0,l=[i,PF2E.proficiencyLevels[n]];return a.properties=l.filter((e=>null!==e)),a},loreChatData(e,t){const a=JSON.parse(JSON.stringify(e.data));if("npc"!==t.type){const e=t.data.abilities[a.ability.value].label,i=a.proficient.value||0,n=[e,PF2E.proficiencyLevels[i]];a.properties=n.filter((e=>null!==e))}return a},backpackChatData(e){const t=JSON.parse(JSON.stringify(e.data));return t.properties=[],t},spellChatData(e,t){var a;const i=JSON.parse(JSON.stringify(e.data)),l=t.items.find((e=>e._id===i.location.value));if(null===l||"spellcastingEntry"!==l.type)return{};const r=l.data.spelldc.dc,s=l.data.spelldc.value;i.isSave="save"===i.spellType.value,i.isSave?i.save.dc=r:i.save.dc=s,i.save.str=i.save.value?PF2E.saves[i.save.value.toLowerCase()]:"",i.damageLabel="heal"===i.spellType.value?n()("PF2E.SpellTypeHeal"):n()("PF2E.DamageLabel"),i.isAttack="attack"===i.spellType.value;const o=[PF2E.spellLevels[i.level.value],`${n()("PF2E.SpellComponentsLabel")}: ${i.components.value}`,i.range.value?`${n()("PF2E.SpellRangeLabel")}: ${i.range.value}`:null,i.target.value?`${n()("PF2E.SpellTargetLabel")}: ${i.target.value}`:null,i.area.value?`${n()("PF2E.SpellAreaLabel")}: ${PF2E.areaSizes[i.area.value]} ${PF2E.areaTypes[i.area.areaType]}`:null,null!==(a=i.areasize)&&void 0!==a&&a.value?`${n()("PF2E.SpellAreaLabel")}: ${i.areasize.value}`:null,i.time.value?`${n()("PF2E.SpellTimeLabel")}: ${i.time.value}`:null,i.duration.value?`${n()("PF2E.SpellDurationLabel")}: ${i.duration.value}`:null];i.spellLvl={}.spellLvl,i.level.value<parseInt(i.spellLvl,10)&&o.push("Heightened: +"+(parseInt(i.spellLvl,10)-i.level.value)),i.properties=o.filter((e=>null!==e));const d=[];if(0!==(i.traits.value||[]).length)for(let e=0;e<i.traits.value.length;e++){const t={label:i.traits.value[e].charAt(0).toUpperCase()+i.traits.value[e].substr(1),description:PF2E.traitsDescriptions[i.traits.value[e]]||""};d.push(t)}return i.traits=d.filter((e=>e)),i},featChatData(e){const t=JSON.parse(JSON.stringify(e.data)),a=[`Level ${t.level.value||0}`,t.actionType.value?PF2E.actionTypes[t.actionType.value]:null];t.properties=a.filter((e=>e));const i=[];if(0!==(t.traits.value||[]).length)for(let e=0;e<t.traits.value.length;e++){const a={label:PF2E.featTraits[t.traits.value[e]]||t.traits.value[e].charAt(0).toUpperCase()+t.traits.value[e].slice(1),description:PF2E.traitsDescriptions[t.traits.value[e]]||""};i.push(a)}return t.traits=i.filter((e=>e)),t},actionChatData(e,t){const a=JSON.parse(JSON.stringify(e.data));let i=null;a.weapon.value&&(i=t.items.find((e=>e._id===a.weapon.value)));const n=[PF2E.actionTypes[a.actionType.value],i?i.name:null];a.properties=n.filter((e=>e));const l=[];if(0!==(a.traits.value||[]).length)for(let e=0;e<a.traits.value.length;e++){const t={label:PF2E.featTraits[a.traits.value[e]]||a.traits.value[e].charAt(0).toUpperCase()+a.traits.value[e].slice(1),description:PF2E.traitsDescriptions[a.traits.value[e]]||""};l.push(t)}return a.traits=l.filter((e=>e)),a},conditionChatData(e){const t=JSON.parse(JSON.stringify(e.data));return t.properties=[],t},effectChatData(e){const t=JSON.parse(JSON.stringify(e.data));return t.properties=[],t}};function V(e){var t,a,i;const n=null!==(t=K(null==e||null===(a=e.potencyRune)||void 0===a?void 0:a.value))&&void 0!==t?t:0;return(null!==(i=K(e.armor.value))&&void 0!==i?i:0)+n}function Y(e){return e<0?`${e}`:e>0?`+${e}`:"0"}function K(e){if(null==e||"number"==typeof e)return e;const t=parseInt(e,10);return Number.isNaN(t)?void 0:t}TextEditor._decoder=document.createElement("textarea");const Q=[{navSelector:".sheet-navigation",contentSelector:".sheet-content",initial:"character"}].map((e=>new Tabs(e)));function X(e){return{0:"icons/svg/mystery-man.svg",1:"systems/pf2e/icons/actions/OneAction.png",2:"systems/pf2e/icons/actions/TwoActions.png",3:"systems/pf2e/icons/actions/ThreeActions.png",free:"systems/pf2e/icons/actions/FreeAction.png",reaction:"systems/pf2e/icons/actions/Reaction.png",passive:"systems/pf2e/icons/actions/Passive.png"}[e]}function Z(e){return{0:"",1:'<i class="fas fa-check-circle"></i>',2:'<i class="fas fa-check-circle"></i><i class="fas fa-check-circle"></i>',3:'<i class="fas fa-check-circle"></i><i class="fas fa-check-circle"></i><i class="fas fa-check-circle"></i>',4:'<i class="fas fa-check-circle"></i><i class="fas fa-check-circle"></i><i class="fas fa-check-circle"></i><i class="fas fa-check-circle"></i>'}[e]}function ee(e,t){return{pp:e.pp+t.pp,gp:e.gp+t.gp,sp:e.sp+t.sp,cp:e.cp+t.cp}}const te=G.spellChatData;function ae(e){const t={};for(let a=0;a<=e.pool;a++){let i="";for(let t=1;t<=e.pool;t++)i+=t<=a?'<i class="fas fa-dot-circle"></i>':'<i class="far fa-circle"></i>';t[a]=i}return t[e.points]}function ie(e,t,a){var i,l,r,s,o,d,u,c,p,v,f;const m=Number(a.data.level.value)<11?Number(a.data.level.value):10;let h=null;if((a.data.location||{}).value&&(h=e.items.find((e=>e._id===a.data.location.value))||{}),!h)return void console.log(`PF2e System | Prepare Spell | Spellcasting entry not found for spell ${a.name}`);const g="wand"===(null===(i=h.data)||void 0===i||null===(l=i.tradition)||void 0===l?void 0:l.value)||"scroll"===(null===(r=h.data)||void 0===r||null===(s=r.tradition)||void 0===s?void 0:s.value)||"ritual"===(null===(o=h.data)||void 0===o||null===(d=o.tradition)||void 0===d?void 0:d.value)||"focus"===(null===(u=h.data)||void 0===u||null===(c=u.tradition)||void 0===c?void 0:c.value),b=null===(p=Object.entries((null===(v=h.data)||void 0===v?void 0:v.slots)||{}))||void 0===p?void 0:p.filter((e=>!!Object.values(e[1].prepared).find((e=>(null==e?void 0:e.id)===a._id)))),y=null!==(f=null==b?void 0:b.map((e=>parseInt(e[0].match(/slot(\d+)/)[1],10))).reduce(((e,t)=>t>e?t:e),0))&&void 0!==f?f:m,k=Math.ceil(e.data.details.level.value/2);for(let e=Math.min(10,Math.max(m,y,k));e>=0;e--){var P,E;if(!g||e===m)t[e]=t[e]||{isCantrip:0===e,isFocus:11===e,label:PF2E.spellLevels[e],spells:[],prepared:[],uses:h&&parseInt(null===(P=h.data)||void 0===P?void 0:P.slots[`slot${e}`].value,10)||0,slots:h&&parseInt(null===(E=h.data)||void 0===E?void 0:E.slots[`slot${e}`].max,10)||0,displayPrepared:!h||!h.data.displayLevels||void 0===h.data.displayLevels[e]||h.data.displayLevels[e],unpreparedSpellsLabel:h&&"arcane"===h.data.tradition.value&&"prepared"===h.data.prepared.value?n()("PF2E.UnpreparedSpellsLabelArcanePrepared"):n()("PF2E.UnpreparedSpellsLabel")}}a.data.school.str=PF2E.spellSchools[a.data.school.value];try{const t=e.items.find((e=>e._id===a._id));t&&(a.spellInfo=te(t,e))}catch(e){console.log(`PF2e System | Character Sheet | Could not load chat data for spell ${a.id}`,a)}t[m].spells.push(a)}function ne(e,t,a){for(const[i,n]of Object.entries(t))if(n.slots>0)for(let t=0;t<n.slots;t++){const l=((e.data.slots[`slot${i}`]||{}).prepared||{})[t]||null;if(l&&l.id){const e=a.items.find((e=>e._id===l.id));if(e){const i=JSON.parse(JSON.stringify(e));if(l.expended?i.expended=!0:i.expended=!1,n.prepared[t]=i,n.prepared[t]){n.prepared[t].data&&n.prepared[t].data.school&&n.prepared[t].data.school.str&&(n.prepared[t].data.school.str=CONFIG.PF2E.spellSchools[n.prepared[t].data.school.value]);try{n.prepared[t].spellInfo=te(e,a)}catch(t){console.log(`PF2e System | Character Sheet | Could not load prepared spell ${l.id}`,e)}n.prepared[t].prepared=!0}else n.prepared[t]={name:"Empty Slot (drag spell here)",id:null,prepared:!1}}else n.prepared[t]={name:"Empty Slot (drag spell here)",id:null,prepared:!1}}else n.prepared[t]={name:"Empty Slot (drag spell here)",id:null,prepared:!1}}}Array.fromRange=function(e){return Array.from(new Array(parseInt(e)).keys())},Hooks.on("showSheet",(function(e,t,a){var i,l;!function(e){o={atLevel:t=>{var a,i,n;const l=null!==(a=null===(i=e.flags)||void 0===i||null===(n=i.externalactor)||void 0===n?void 0:n.proficiencyUntrainedModifier)&&void 0!==a?a:0;return new s("PF2E.ProficiencyLevel0",l,r.PROFICIENCY)}},d={atLevel:t=>{var a,i,n,l,o,d;const u=null!==(a=null===(i=e.flags)||void 0===i||null===(n=i.externalactor)||void 0===n?void 0:n.proficiencyVariant)&&void 0!==a?a:"ProficiencyWithLevel";let c=null!==(l=null===(o=e.flags)||void 0===o||null===(d=o.externalactor)||void 0===d?void 0:d.proficiencyTrainedModifier)&&void 0!==l?l:2;return"ProficiencyWithLevel"===u&&(c+=t),new s("PF2E.ProficiencyLevel1",c,r.PROFICIENCY)}},u={atLevel:t=>{var a,i,n,l,o,d;const u=null!==(a=null===(i=e.flags)||void 0===i||null===(n=i.externalactor)||void 0===n?void 0:n.proficiencyVariant)&&void 0!==a?a:"ProficiencyWithLevel";let c=null!==(l=null===(o=e.flags)||void 0===o||null===(d=o.externalactor)||void 0===d?void 0:d.proficiencyExpertModifier)&&void 0!==l?l:4;return"ProficiencyWithLevel"===u&&(c+=t),new s("PF2E.ProficiencyLevel2",c,r.PROFICIENCY)}},c={atLevel:t=>{var a,i,n,l,o,d;const u=null!==(a=null===(i=e.flags)||void 0===i||null===(n=i.externalactor)||void 0===n?void 0:n.proficiencyVariant)&&void 0!==a?a:"ProficiencyWithLevel";let c=null!==(l=null===(o=e.flags)||void 0===o||null===(d=o.externalactor)||void 0===d?void 0:d.proficiencyMasterModifier)&&void 0!==l?l:6;return"ProficiencyWithLevel"===u&&(c+=t),new s("PF2E.ProficiencyLevel3",c,r.PROFICIENCY)}},p={atLevel:t=>{var a,i,n,l,o,d;const u=null!==(a=null===(i=e.flags)||void 0===i||null===(n=i.externalactor)||void 0===n?void 0:n.proficiencyVariant)&&void 0!==a?a:"ProficiencyWithLevel";let c=null!==(l=null===(o=e.flags)||void 0===o||null===(d=o.externalactor)||void 0===d?void 0:d.proficiencyLegendaryModifier)&&void 0!==l?l:8;return"ProficiencyWithLevel"===u&&(c+=t),new s("PF2E.ProficiencyLevel4",c,r.PROFICIENCY)}}}(t);const m=function(e,t){var a,i,l,r,s,o,d,u,c,p,m,h;let y=e.items;y.sort(((e,t)=>(e.sort||0)-(t.sort||0))),null!==(a=e.data.details)&&void 0!==a&&null!==(i=a.alignment)&&void 0!==i&&i.value&&(e.data.details.alignment.value=PF2E.alignment[e.data.details.alignment.value]);null!==(l=e.data.traits)&&void 0!==l&&null!==(r=l.size)&&void 0!==r&&r.value&&(e.data.traits.size.value=PF2E.actorSizes[e.data.traits.size.value]);null!==(s=e.data.details)&&void 0!==s&&null!==(o=s.keyability)&&void 0!==o&&o.value&&(e.data.details.keyability.value=PF2E.abilities[e.data.details.keyability.value]);Object.keys(e.data.abilities).forEach((t=>{e.data.abilities[t].label=PF2E.abilities[t]})),Object.keys(e.data.saves).forEach((t=>{e.data.saves[t].label=PF2E.saves[t],e.data.saves[t].rankName=PF2E.proficiencyLevels[e.data.saves[t].rank]})),e.data.attributes.heroPoints&&(e.data.attributes.heroPoints.icon={0:'<i class="far fa-circle"></i><i class="far fa-circle"></i><i class="far fa-circle"></i>',1:'<i class="fas fa-hospital-symbol"></i><i class="far fa-circle"></i><i class="far fa-circle"></i>',2:'<i class="fas fa-hospital-symbol"></i><i class="fas fa-hospital-symbol"></i><i class="far fa-circle"></i>',3:'<i class="fas fa-hospital-symbol"></i><i class="fas fa-hospital-symbol"></i><i class="fas fa-hospital-symbol"></i>'}[e.data.attributes.heroPoints.rank],e.data.attributes.heroPoints.hover=PF2E.heroPointLevels[e.data.attributes.heroPoints.rank]);e.data.attributes.dying&&(e.data.attributes.dying.containerWidth=`width: ${13*e.data.attributes.dying.max}px;`,e.data.attributes.dying.icon=function(e,t){const a=t.data.attributes.dying.max||4,i=t.data.attributes.doomed.value||0,n='<i class="far fa-circle"></i>',l='<i class="fas fa-times-circle"></i>',r='<i class="fas fa-skull"></i>',s="<span>",o="</span>",d={};for(let e=0;e<=a;e++){d[e]=e===a?s:"";for(let t=1;t<=a;t++)d[e]+=t>=a-i||e===a?r:e<t?n:l;d[e]+=e===a?o:""}return d[e]}(e.data.attributes.dying.value,e));e.data.attributes.wounded&&(e.data.attributes.wounded.icon=function(e,t){const a=t.data.attributes.dying.max||4,i={},n='<i class="fas fa-dot-circle"></i>',l='<i class="far fa-circle"></i>';for(let e=0;e<a;e++){let t="";for(let i=1;i<a;i++)t+=i<=e?n:l;i[e]=t}return i[e]}(e.data.attributes.wounded.value,e),e.data.attributes.wounded.max=e.data.attributes.dying.max-1);e.data.attributes.doomed&&(e.data.attributes.doomed.icon=function(e,t){const a=t.data.attributes.dying.max||4,i={},n='<i class="fas fa-skull"></i>',l='<i class="far fa-circle"></i>';for(let e=0;e<a;e++){let t="";for(let i=1;i<a;i++)t+=i<=e?n:l;i[e]=t}return i[e]}(e.data.attributes.doomed.value,e),e.data.attributes.doomed.max=e.data.attributes.dying.max-1);null!==(d=e.data.attributes)&&void 0!==d&&null!==(u=d.perception)&&void 0!==u&&u.rank&&(e.data.attributes.perception.rankName=PF2E.proficiencyLevels[e.data.attributes.perception.rank]);null!==(c=e.data.attributes)&&void 0!==c&&null!==(p=c.classDC)&&void 0!==p&&p.rank&&(e.data.attributes.classDC.rankName=PF2E.proficiencyLevels[e.data.attributes.classDC.rank]);if(null!==(m=e.data)&&void 0!==m&&m.martial)for(const[t,a]of Object.entries(e.data.martial))a.icon=Z(a.rank),a.hover=PF2E.proficiencyLevels[a.rank],a.label=PF2E.martialSkills[t],a.value=v.fromLevelAndRank(e.data.details.level.value,a.rank||0).modifier;if(null!==(h=e.data)&&void 0!==h&&h.skills)for(const[t,a]of Object.entries(e.data.skills)){var k;a.icon=Z(a.rank),a.hover=PF2E.proficiencyLevels[a.rank],a.label=null!==(k=a.label)&&void 0!==k?k:PF2E.skills[t]}if(function(e){var t,a,i,l,r,s,o,d,u,c;const p={weapon:{label:n()("PF2E.InventoryWeaponsHeader"),items:[]},armor:{label:n()("PF2E.InventoryArmorHeader"),items:[]},equipment:{label:n()("PF2E.InventoryEquipmentHeader"),items:[],investedItemCount:0},consumable:{label:n()("PF2E.InventoryConsumablesHeader"),items:[]},treasure:{label:n()("PF2E.InventoryTreasureHeader"),items:[]},backpack:{label:n()("PF2E.InventoryBackpackHeader"),items:[]}},f=[],m=[],h=[];h.unassigned={};const y=[],k={ancestry:{label:"PF2E.FeatAncestryHeader",feats:[]},ancestryfeature:{label:"PF2E.FeaturesAncestryHeader",feats:[]},archetype:{label:"PF2E.FeatArchetypeHeader",feats:[]},bonus:{label:"PF2E.FeatBonusHeader",feats:[]},class:{label:"PF2E.FeatClassHeader",feats:[]},classfeature:{label:"PF2E.FeaturesClassHeader",feats:[]},skill:{label:"PF2E.FeatSkillHeader",feats:[]},general:{label:"PF2E.FeatGeneralHeader",feats:[]},pfsboon:{label:"PF2E.FeatPFSBoonHeader",feats:[]},deityboon:{label:"PF2E.FeatDeityBoonHeader",feats:[]},curse:{label:"PF2E.FeatCurseHeader",feats:[]}},P={action:{label:n()("PF2E.ActionsActionsHeader"),actions:[]},reaction:{label:n()("PF2E.ActionsReactionsHeader"),actions:[]},free:{label:n()("PF2E.ActionsFreeActionsHeader"),actions:[]}},F={interaction:{label:"Interaction Actions",actions:[]},defensive:{label:"Defensive Actions",actions:[]},offensive:{label:"Offensive Actions",actions:[]}},C=[],w={weapon:{label:"Compendium Weapon",items:[],type:"weapon"}},L=[],$=[],S={ignoreCoinBulk:(null===(t=e.flags)||void 0===t||null===(a=t.externalactor)||void 0===a?void 0:a.ignoreCoinBulk)||g.ignoreCoinBulk,ignoreContainerOverflow:(null===(i=e.flags)||void 0===i||null===(l=i.externalactor)||void 0===l?void 0:l.ignoreContainerOverflow)||g.ignoreContainerOverflow},B=A(e),O=I(B),x=function(e=[],t=new Map,a,i=g){const n=z(e,(e=>e._id)),l=z(e,(e=>{var t,a;const i=null==e||null===(t=e.data)||void 0===t||null===(a=t.containerId)||void 0===a?void 0:a.value;return n.has(i)?i:null})),r=new Map;for(const c of e){var s,o,d,u;const e=l.has(null==c||null===(s=c.data)||void 0===s||null===(o=s.containerId)||void 0===o?void 0:o.value),p=l.get(c._id)||[];r.set(c._id,R(n.get(c._id)[0],p,null!==(d=null===(u=t.get(c._id))||void 0===u?void 0:u.holdsItems)&&void 0!==d?d:[],e,a,i))}return r}(e.items,O,M,S);let T=0;for(const t of e.items){var N,_,D,q,j,J,U,G,V,Y,K,Q;if(t.img=t.img||"icons/svg/mystery-man.svg",t.containerData=x.get(t._id),t.isContainer=t.containerData.isContainer,t.isNotInContainer=t.containerData.isNotInContainer,"armor"!==t.type&&"equipment"!==t.type&&"consumable"!==t.type&&"backpack"!==t.type||(C.push(t),e.hasEquipment=!0),t.canBeEquipped=t.isNotInContainer,t.isEquipped=null!==(N=null===(_=t.data)||void 0===_||null===(D=_.equipped)||void 0===D?void 0:D.value)&&void 0!==N&&N,t.isSellableTreasure="treasure"===t.type&&"coins"!==(null===(q=t.data)||void 0===q||null===(j=q.stackGroup)||void 0===j?void 0:j.value),t.hasInvestedTrait=null!==(J=null===(U=t.data)||void 0===U||null===(G=U.traits)||void 0===G||null===(V=G.value)||void 0===V?void 0:V.includes("invested"))&&void 0!==J&&J,t.isInvested=null!==(Y=null===(K=t.data)||void 0===K||null===(Q=K.invested)||void 0===Q?void 0:Q.value)&&void 0!==Y&&Y,t.isInvested&&(T+=1),Object.keys(p).includes(t.type)){t.data.quantity.value=t.data.quantity.value||0,t.data.weight.value=t.data.weight.value||0;const[e]=b([O.get(t._id)],M,!1,S);t.totalWeight=E(e),t.hasCharges="consumable"===t.type&&t.data.charges.max>0,t.isTwoHanded="weapon"===t.type&&!!(t.data.traits.value||[]).find((e=>e.startsWith("two-hand"))),t.wieldedTwoHanded="weapon"===t.type&&(t.data.hands||{}).value,"weapon"===t.type&&w.weapon.items.push(t),p[t.type].items.push(t)}else if("spell"===t.type){let a;try{a=e.items.find((e=>e._id===t._id)),t.spellInfo=te(a,e)}catch(e){console.log(`PF2e System | Character Sheet | Could not load item ${t.name}`)}f.push(t)}else if("spellcastingEntry"===t.type){var ee;m.push(t._id);const a=(null===(ee=t.data.proficiency)||void 0===ee?void 0:ee.value)||0,i=v.fromLevelAndRank(e.data.details.level.value,a).modifier,n=t.data.ability.value||"int";t.data.spelldc.mod=e.data.abilities[n].mod,t.data.spelldc.breakdown=`10 + ${n} modifier(${e.data.abilities[n].mod}) + proficiency(${i}) + item bonus(${t.data.item.value})`,t.data.spelldc.icon=Z(t.data.proficiency.value),t.data.spelldc.hover=PF2E.proficiencyLevels[t.data.proficiency.value],t.data.tradition.title=PF2E.magicTraditions[t.data.tradition.value],t.data.prepared.title=PF2E.preparationType[t.data.prepared.value],"prepared"===(t.data.prepared||{}).value?t.data.prepared.preparedSpells=!0:t.data.prepared.preparedSpells=!1,"ritual"===(t.data.tradition||{}).value?t.data.tradition.ritual=!0:t.data.tradition.ritual=!1,"focus"===(t.data.tradition||{}).value?(t.data.tradition.focus=!0,void 0===t.data.focus&&(t.data.focus={points:1,pool:1}),t.data.focus.icon=ae(t.data.focus)):t.data.tradition.focus=!1,y.push(t)}else if("feat"===t.type){const a=t.data.featType.value||"bonus",i=t.data.actionType.value||"passive";if(k[a].feats.push(t),Object.keys(P).includes(i)){t.feat=!0;let a=0;if("action"===i?a=parseInt((t.data.actions||{}).value,10)||1:"reaction"===i?a="reaction":"free"===i&&(a="free"),t.img=X(a),P[i].actions.push(t),t.data.actionCategory&&t.data.actionCategory.value)switch(t.data.actionCategory.value){case"interaction":F.interaction.actions.push(t),e.hasInteractionActions=!0;break;case"defensive":F.defensive.actions.push(t),e.hasDefensiveActions=!0;break;default:F.offensive.actions.push(t),e.hasOffensiveActions=!0}else F.offensive.actions.push(t),e.hasOffensiveActions=!0}}else if("lore"===t.type){var le;t.data.icon=Z((t.data.proficient||{}).value),t.data.hover=PF2E.proficiencyLevels[(t.data.proficient||{}).value];const a=(null===(le=t.data.proficient)||void 0===le?void 0:le.value)||0,i=v.fromLevelAndRank(e.data.details.level.value,a).modifier,n=e.data.abilities.int.mod,l=Number((t.data.item||{}).value||0);t.data.itemBonus=l,t.data.value=n+i+l,t.data.breakdown=`int modifier(${n}) + proficiency(${i}) + item bonus(${l})`,L.push(t)}else if("martial"===t.type){var re;t.data.icon=Z((t.data.proficient||{}).value),t.data.hover=PF2E.proficiencyLevels[(t.data.proficient||{}).value];const a=(null===(re=t.data.proficient)||void 0===re?void 0:re.value)||0,i=v.fromLevelAndRank(e.data.details.level.value,a).modifier;t.data.value=i,t.data.breakdown=`proficiency(${i})`,$.push(t)}if("action"===t.type){const a=t.data.actionType.value||"action";let i=0;if("action"===a?i=parseInt(t.data.actions.value,10)||1:"reaction"===a?i="reaction":"free"===a?i="free":"passive"===a&&(i="passive"),t.img=X(i),"passive"===a?P.free.actions.push(t):P[a].actions.push(t),t.data.actionCategory&&t.data.actionCategory.value)switch(t.data.actionCategory.value){case"interaction":F.interaction.actions.push(t),e.hasInteractionActions=!0;break;case"defensive":F.defensive.actions.push(t),e.hasDefensiveActions=!0;break;case"offensive":F.offensive.actions.push(t),e.hasOffensiveActions=!0;break;default:F.offensive.actions.push(t),e.hasOffensiveActions=!0}else F.offensive.actions.push(t),e.hasOffensiveActions=!0}}p.equipment.investedItemCount=T;const se=[];for(const t of f)if(m.includes(t.data.location.value)){const a=t.data.location.value;h[a]=h[a]||{},ie(e,h[a],t)}else if(1===m.length){const a=m[0];h[a]=h[a]||{},se.push({_id:t._id,"data.location.value":m[0]}),ie(e,h[a],t)}else ie(e,h.unassigned,t);Object.values(P).flatMap((e=>e.actions)).forEach((e=>{e.downtime=e.data.traits.value.includes("downtime"),e.exploration=e.data.traits.value.includes("exploration"),e.encounter=!(e.downtime||e.exploration)})),e.inventory=p,Object.keys(h.unassigned).length&&(e.orphanedSpells=!0,e.orphanedSpellbook=h.unassigned);e.feats=k,e.attacks=w,e.actions=P,e.readonlyActions=F,e.readonlyEquipment=C,e.lores=L,e.martialSkills=$;for(const t of y)t.data.prepared.preparedSpells&&h[t._id]&&ne(t,h[t._id],e),t.spellbook=h[t._id];e.spellcastingEntries=y;const oe=(de=e.items,de.find((e=>"armor"===e.type&&e.data.equipped.value&&"shield"===e.data.armorType.value)));var de;if(void 0===oe)e.data.attributes.shield={hp:{value:0},maxHp:{value:0},armor:{value:0},hardness:{value:0},brokenThreshold:{value:0}},e.data.attributes.shieldBroken=!1;else{var ue,ce,pe,ve;e.data.attributes.shield=JSON.parse(JSON.stringify(oe.data)),e.data.attributes.shieldBroken=(null==oe||null===(ue=oe.data)||void 0===ue||null===(ce=ue.hp)||void 0===ce?void 0:ce.value)<=(null==oe||null===(pe=oe.data)||void 0===pe||null===(ve=pe.brokenThreshold)||void 0===ve?void 0:ve.value)}const fe=new Set(e.items.filter((e=>"feat"===e.type)).map((e=>e.name)));let me=null!==(r=e.data.attributes.bonusEncumbranceBulk)&&void 0!==r?r:0,he=null!==(s=e.data.attributes.bonusLimitBulk)&&void 0!==s?s:0;fe.has("Hefty Hauler")&&(me+=2,he+=2);void 0!==e.items.find((e=>"Lifting Belt"===e.name&&e.data.equipped.value))&&(me+=1,he+=1);const[ge]=b(B,M,!1,S);e.data.attributes.encumbrance=function(e,t,a,i,n="Medium"){const l=H[n].bulkLimitFactor,r=Math.floor((e+t+5)*l),s=Math.floor((e+a+10)*l);return new W(i,r,s)}(e.data.abilities.str.mod,me,he,ge,null!==(o=null===(d=e.data)||void 0===d||null===(u=d.traits)||void 0===u||null===(c=u.size)||void 0===c?void 0:c.value)&&void 0!==o?o:"Medium")}(e),e.items){const t=function(e){return e.filter((e=>{var t,a,i,n;return"treasure"===e.type&&void 0!==(null==e||null===(t=e.data)||void 0===t||null===(a=t.denomination)||void 0===a?void 0:a.value)&&null!==(null==e||null===(i=e.data)||void 0===i||null===(n=i.denomination)||void 0===n?void 0:n.value)})).map((e=>{var t,a,i,n,l,r;const s=(null!==(t=null===(a=e.data)||void 0===a||null===(i=a.value)||void 0===i?void 0:i.value)&&void 0!==t?t:1)*(null!==(n=null===(l=e.data)||void 0===l||null===(r=l.quantity)||void 0===r?void 0:r.value)&&void 0!==n?n:1);return function(e,t){return{pp:"pp"===e?t:0,gp:"gp"===e?t:0,sp:"sp"===e?t:0,cp:"cp"===e?t:0}}(e.data.denomination.value,s)})).reduce(ee,{pp:0,gp:0,sp:0,cp:0})}(e.items);e.totalTreasure={};for(const[a,i]of Object.entries(t))e.totalTreasure[a]={value:i,label:PF2E.currencies[a]}}return function(e){if(void 0===e)return;const t={languages:PF2E.languages,dr:PF2E.resistanceTypes,di:PF2E.immunityTypes,dv:PF2E.weaknessTypes,ci:PF2E.immunityTypes,traits:PF2E.monsterTraits};for(const[a,i]of Object.entries(t)){const t=e[a]||{value:[],selected:[]};if(Array.isArray(t)){t.selected={};for(const e of t)if("object"==typeof e)if("exceptions"in e&&""!==e.exceptions)t.selected[e.type]=`${i[e.type]} (${e.value}) [${e.exceptions}]`;else{let a=`${i[e.type]}`;""!==e.value&&(a=`${a} (${e.value})`),t.selected[e.type]=a}else t.selected[e]=i[e]||`${e}`}else t.value&&(t.selected=Object.fromEntries(t.value.map((e=>[e,e]))));t.custom&&(t.selected.custom=t.custom)}}(e.data.traits),e.data.effects={},e.data.effects.conditions=f.getFlattenedConditions(e.items.filter((e=>{var t;return(null===(t=e.flags.pf2e)||void 0===t?void 0:t.condition)&&"condition"===e.type}))),{actorData:e,items:y}}(t),h={actor:m.actorData,data:m.actorData.data,items:m.actorData.items,isCharacter:"character"===m.actorData.data.type,isNPC:"npc"===m.actorData.data.type,hasStamina:(null===(i=m.actorData.flags)||void 0===i||null===(l=i.externalactor)||void 0===l?void 0:l.hasStamina)||!1,totalTreasure:m.actorData.totalTreasure,pfsFactions:PF2E.pfsFactions,owner:!0,baseUrl:a};console.log(h),$(".window-content")[0].innerHTML=e(h,{allowedProtoProperties:{size:!0,isCollapsed:!0,isOverLoaded:!0,fullPercentageMax100:!0,isEncumbered:!0,isOverLimit:!0,limitPercentageMax100:!0,bulk:!0}}),function(e){const t=$(".window-content").first();Q.forEach((e=>e.bind(t[0])));{const e=$(".sheet-navigation .active").data("tabTitle");e&&t.find(".navigation-title").text(e)}t.find(".sheet-navigation").on("mouseover",".item",(e=>{const t=e.currentTarget.dataset.tabTitle;t&&$(e.currentTarget).parents(".sheet-navigation").find(".navigation-title").text(t)})),t.find(".sheet-navigation").on("mouseout",".item",(e=>{const t=$(e.currentTarget).parents(".sheet-navigation"),a=t.find(".item.active").data("tabTitle");a&&t.find(".navigation-title").text(a)})),t.find(".item .item-name h4").click((t=>{!function(e,t){e.preventDefault();const a=$(e.currentTarget).parent().parent(),i=a.attr("data-item-id");let l;if("spellSlot"===a.attr("data-item-type"))return;try{if(l=t.items.find((e=>e._id===i)),!l.type)return}catch(e){return}if("spellcastingEntry"===l.type||"condition"===l.type)return;const r=function(e,t,a){const i=e.type,n=G[`${i}ChatData`](e,t);n&&(n.description.value=TextEditor.enrichHTML(n.description.value,a));return n}(l,t,{secrets:t.owner});!function(e,t){if(e.hasClass("expanded")){const t=e.children(".item-summary");t.slideUp(200,(()=>t.remove()))}else{const a=$(`<div class="item-summary"><div class="item-description">${t.description.value}</div></div>`),i=$('<div class="item-properties tags"></div>');t.properties&&t.properties.filter((e=>"string"==typeof e)).forEach((e=>{i.append(`<span class="tag tag_secondary">${n()(e)}</span>`)})),t.critSpecialization&&i.append(`<span class="tag" title="${n()(t.critSpecialization.description)}" style="background: rgb(69,74,124); color: white;">${n()(t.critSpecialization.label)}</span>`),t.traits&&t.traits.length&&t.traits.forEach((e=>{e.description?i.append(`<span class="tag tag_alt" title="${n()(e.description)}">${n()(e.label)}</span>`):i.append(`<span class="tag">${n()(e.label)}</span>`)})),a.append(i),e.append(a.hide()),a.slideDown(200)}e.toggleClass("expanded")}(a,r)}(t,e)})),t.find(".strikes-list [data-action-index]").on("click",".action-name",(e=>{$(e.currentTarget).parents(".expandable").toggleClass("expanded")})),t.find(".actions-nav").on("click",".tab:not(.tab-active)",(e=>{const t=$(e.currentTarget),a=t.parents(".actions-nav");a.children(".tab-active").removeClass("tab-active"),a.siblings(".actions-panels").children(".actions-panel.active").removeClass("active"),t.addClass("tab-active"),a.siblings(".actions-panels").children(`#${t.data("panel")}`).addClass("active")})),t.find("[data-wpad]").each(((e,t)=>{const a=("INPUT"===t.tagName?t.value:t.innerText).length*parseInt(t.getAttribute("data-wpad"),10)/2;t.setAttribute("style",`flex: 0 0 ${a}px`)})),t.find(".hover").tooltipster({animation:"fade",delay:200,trigger:"click",arrow:!1,contentAsHTML:!0,debug:!0,interactive:!0,side:["right","bottom"],theme:"crb-hover",minWidth:120})}(t)}))}});
//# sourceMappingURL=populatesheet.js.map